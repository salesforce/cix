# CIX Release Notes

### 2.7.4
* Bug-fix: Add type 'boolean' to environmentSchema for value and default

### 2.7.2
* Added support for using images with sha256 digests instead of tags

### 2.7.1
* Added new Operators (MATCHES, NOT_MATCHES) for regular expression checks.

### 2.7.0
* Updated CIX to run on Node.js 16 
* Updated npm dependencies
* Bug-fix: refactor loop, for-each, so they work with continue-on-fail and retry

### 2.6.9
* Bug-fix: Added right docker network for the CIX container
* Bug-fix: Increased the remote stream readable watermark to 10MB
* Bug-fix: Fixed the privilege access mode
* Updated npm dependencies

### 2.6.8
* Bug-fix: chained pipelines showing successful in some cases where they fail

### 2.6.7
* Bug-fix: exec --remote can hang on failed pipelines

### 2.6.6
* Removed logging version within install command. 
* Upgraded node packages to the latest versions. 
* Can replace the ephemeral network creation with your own network:
  * Can switch to experimental host networking by exporting `DOCKER_NETWORK=host` before running CIX
  * Can use an existing network by providing it's name by exporting `DOCKER_NETWORK=my-network-name` before running CIX 

### 2.6.5
* Added `-L, --logname <name>`, a way to specify a different log file name than cix-execution.log.
* Added `--silent`, a way to suppress all output.
* Added environment variables `CIX_SEVER_PORT`, `CIX_WORKSPACE`, `CIX_WORKDIR` and `CIX_TEMP`. Detailed [here](/reference/environment).

### 2.6.4
* Fix logging to background steps

### 2.6.3
* Add new logger that writes to a single file.
* Now multiplexing logs from different pipelines (no longer all sharing a single global logger).
* Fixed bug where container logger would not log the last line if it didn't contain a newline.
* Fixed a bug where we were logging container output in color for log files.  

### 2.6.2 
* Allow `for-each` to be a single element, have trailing commas or be empty.

### 2.6.1
* Allow pipline to continue if step is both continue-on-fail: true and timeout is reached.
* Allow $$ENV variables in `for-each`.

### 2.6.0
* Enhanced `for-each` loop for `step`. See [this page for more](/tutorials/flow?id=loops).
* Fixed teardown being unable to remove resources when background containers were still running.
* Improved validation of step names.
* As a special case, allow unquoted boolean and number types in `arguments` and `commands` properties.
* Updated npm dependencies.
* Updated `when:` to support `AND` and also fixed `INCLUDES` w.r.t. empty strings causing a match. 

### 2.5.3
* Users now have the ability to override the default pull-policy on an entire pipeline when using `load` or `exec`. See `cix help load` and `cix help exec` for more details.
* `step` now supports a `commands-output` [property](/reference/yaml?id=commands-output) with the following values:
  * `timestamp` echoes all of the commands (w/ timestamp). Note, this is the default mode and the previous behavior of CIX.
  * `echo` echoes all of the commands (no timestamp).
  * `minimal` CIX will only display the stdout/stderr generated by the step's commands.
* Bugfix: Now able to see SILLY and DEBUG logs when streaming logs from server to a client.

### 2.5.1
* If an environment variable is not provided for variable `user` definitions in a step, the step will now run as root.

### 2.5.0
* Added the ability to pass environment to a step while only providing the name of the environment variable.
  * For example:
  ```yaml
  version: 2.1
  pipeline:
    - step:
        name: environment
        image: alpine:3.9
        environment:
          - name: FOO # value == $$FOO
          - name: BAR # value == $$BAR
            default: bar-default # default works the same regardless of how value is defined
        commands:
          - echo $FOO
          - echo $BAR
  ```
* Added the ability to force color mode in non-TTY CIX console logging mode, or force no color mode in TTY mode with `--color` and `--no-color`.
* Added the ability to specify a user on a `step`. The user field accepts username or UID (format: <name|uid>[:<group|gid>]).
  * Example:
  ```yaml
  version: 2.1
  pipeline:
    - step:
        name: example
        user: '$$MY_USER'
  ```
* Fixed an issue where log stream between a client and server would close after no activity for 120 seconds.
* Fixed an issue where console output would not show when changing the CIX logging level below INFO.
* Updated the CIX install script to set a more restrictive umask.
* Updated the Dockerfile base image to latest CentOS image.
* Fixed an issue where Docker pull retries would be stripped of the user credentials, leading to the retry mechanism exiting and failing the pipeline.
* Clarified some CIX logging messages to make the cause of a pipeline failure more clear.
* When a preprocessor is defined, it is now run on imports.

### 2.4.2
* Fixed a bug with GIT imports, where you couldn't mix local and GIT imports. We're also now able to correctly use http-authorization-token YAML attribute.
* Fixed a bug with timeouts, where if a timeout was specified and a step fails, it would hang until timeout was reached.
* Do not expose CIX API port when CIX is overridden to run on a preconfigured docker network.
* Added `pipelines`, `plugins`, and `prompted-secrets` to the configuration file.
* Added the ability to prompt for multiple secrets.

### 2.4.1
* `exec --remote`, `resume` and `next` block execution of the client until either the pipeline is paused or becomes terminal.
  * Blocking executions can be disabled with the flag --non-blocking.
* `exec --remote`, `resume` and `next` can now stream logs from the server and display them on the client.
  * Remote log streams can be disabled with --no-remote-logs.
* Updated `--env` and `--secret` with the ability to pass environment variables by name only, using their values from the calling environment.
* Added the `arguments` step attribute so additional parameters can be provided to an image's default ENTRYPOINT command.
* Detach from the console when starting the CIX server (`cix server` command).
* Migrated from custom nodejs base image to new common Strata nodejs base image.
* NPM dependency cleanup and upgrades.
* Added the `workspace-mount-point` step attribute to specify a different target to mount the workspace directory in the container.

### 2.4.0
* Added a plugin framework to CIX. The first feature to take advantage of the new framework is "preprocessors." A preprocessor allows a non-native pipeline to be transformed into a valid CIX pipeline before execution.
* Fixed a bug where teardown was not run after a pipeline failure.
* `cix describe` now displays environment variables defined within a pipeline.
* `cix resume --to step` now runs to and including the specified step.

### 2.3.1
* Restored CIX to loading chained YAML files to just before they get executed ("just-in-time"), rather than at the start of the first pipeline execution. This allows users to dynamically add or sync pipelines from earlier ones at runtime.
* Fixed issues with reading secrets from stdin with and without a TTY.
* Added the ability for users to define a .cixconfig file for some flags which would previously have to be specified on each CIX invocation. See [documentation](/reference/local-configuration.md) for more information.

### 2.3.0
* Added new CLI commands and server endpoints to support phased execution. Please check out [the documentation](/tutorials/phased-exec) for more information.
* Added support for passing in secrets through standard input rather than command line. Please check out [the documentation](/tutorials/secrets#standard-input) for more information.
* Added support to POST pipelines as JSON though the REST API, which removes the need to have the YAML pipeline files available on the server.
* Preliminary support for launching pipeline steps to a Kubernetes cluster.
* Return to using `:latest` as the default image tag in the `cix` wrapper script. The default can be overridden by [setting the CIX_IMAGE environment variable](/reference/cli.md#specifying-the-cix-docker-image-to-use).

### 2.2.2
* Perform a clean shutdown when the INT (Ctrl-C) and TERM signals are received.

### 2.2.1
* When executed by the shell, step `commands` now defaults to `set -e` or 'fail on error' mode, such that any failed
command will abort the pipeline. A step's failure mode can be manually overridden to 'ignore errors' by calling
`set +e` in your `commands` list.
* Refactored loggers to take care of the bug where containers log to multiple files.

### 2.2.0
* Added new Rest API, the API starts up at http://localhost:10030/api-docs and has the following functionality:
  * Adding new pipelines to execute
  * Chaining together pipeline executions
  * Checking the status of a pipeline execution
  * Adding new environment variables at runtime
  * Ability to start CIX in a server mode with `cix server`
* Refactored much of the code, including upgrading all npm dependencies.

### 2.1.19
* Use `:latest` as the default image version in the wrapper script until renamed CIX is more widespread.

### 2.1.18
* It's time to make it official! The command to start CIX is now `cix`, while `cix2` is deprecated but will continue
to be supported for the foreseeable future. To update your image and wrapper script run `cix2 update` followed by
`cix2 install | sudo sh`. You may then use the command `cix` to run CIX.
* Added ability to use $$ environment format within the environment variables and registry host name `default` key.
* Default to console logging and remove Chalk colors if logging in files mode.
* Move from the jsonschema package to the [ajv](https://www.npmjs.com/package/ajv) package for schema validation.
* Allow the use of alternative interpreters for `commands`. Write your step commands in Python, NodeJS, etc. as long
as it is supported by the image.
* Bug fix: in shell scripts the `$?` variable was being overwritten before it could be used by a subsequent command.
* Add timestamp to container commands echo lines.
* To ensure the shell wrapper script is in-sync with the cix image, a version comparison is now performed and warning
emitted if it is outdated.

### 2.1.17
* Added ability to retry the image pull operation, to be more resilient to registry connection issues. Retries
are configured via the new `retry` attribute of the `registry` definition.

### 2.1.16
* Bug fix: fix obfuscation bug in maskSecrets function.

### 2.1.15
* Bug fix: avoid using the "function" shell keyword in the cixrc shell script to support older Bourne shells.

### 2.1.14
* [Registries](/reference/yaml.md#registry) may now be defined by alias, with optional default value. This allows the registry
host to be overridden from the command-line. Alternatively, multiple registries may be defined and one selected from the
set using a command line variable.
* Allow `ports` to be defined with command-line variables.
* Fixed a bug where secrets passed with empty strings or regex control characters caused issues during the secret
masking process.
* Fixed a bug where the unquoted words `true` and `false` were not treated as strings in `when` condition operands.
* When using file logging, step numbers are now padded to two digits for easier sorting.
* Added `INCLUDES` (a.k.a. contains) and `NOT INCLUDES` to available simple conditional operators.

### 2.1.13
* Added check to ensure `exec` will not attempt to process invalid YAML.

### 2.1.12
* Addition of the "OR" [conditional operator](/reference/yaml.md#when).
* Fixed a bug where the Teardown pipeline was not executed when the main pipeline failed.

### 2.1.11
* Steps can be executed based on conditional evaluation of variables with the [when](/reference/yaml.md#when) attribute.
* Imports can now be nested within other imports.
* Multiple YAML files may be specified on the command line using repeated `--yaml` (`-y`) options. Each one will be
executed in order. Files are parsed when encountered so they do not need to exist prior to starting the pipeline.
This allows YAML files to be generated by previous files in the chain.
* Pipelines can be fetched from GitHub, which creates the ability to run "managed pipelines." Refer to the
[cix exec managed](/reference/cli.md#cix-exec-managed) command in the CLI reference.
* A new attribute [commands-shell](/reference/yaml.md#commands-shell) has been introduced to specify the shell binary under
which to run `commands`. This is useful when the default /bin/sh in an image is not the one you would like to run
commands with, but there is a separate shell installed (typically /bin/bash). The replacement shell must be
Bourne-compatible.
* The [privileged](/reference/yaml.md#privileged) attribute has been added to enable Docker privileged mode for containers,
primarily for Docker-in-Docker (running the full Docker engine in a container).
* Fix for `cix install` so it doesn't output CR-LF and break the newly installed file name and contents. Because
this bug is present in the existing script, use the `docker run` instructions from the
[Getting Started guide](getting-started.md) to get the updated version. Future updates can be performed by simply running
`cix install | sudo sh`.
* The 'cix' wrapper script has been improved to allow spaces in `-e` and `-s` parameters.
* When the logging mode is 'files' (`--logging files`), general CIX output is now sent to the console as well.
* Containers are deleted immediately after they are finished, which helps to avoid naming conflicts for repeated steps.
* Fixed erroneous `$$` variable expansion when two overlapping names were defined.

### 2.1.10
* Added ability to specify defaults for environment variables when they are not defined by `-e`, `-s` arguments on the
command line.
* Added ability to validate schema command in cix-cli `cix validate -y your.yaml`.
* Added two new volume mounts to each step: /cix/bin and /cix/libexec. These will be used for shared scripts developed
by the CIX team.
* Change github docs theme to Cayman.

### 2.1.9
* When the 'files' logging mode is enabled (with `--logging files`), general output is saved to `cix-execution.log` as
in CIX 1.
* The default logging level has been changed from WARN to INFO.

### 2.1.2
* Bug fix: fix failing Payload test and skip pipeline creation if schema validation fails.

### 2.1.1
* __USER ACTION REQUIRED__ - YAML changes are required to upgrade from CIX 2.0 to 2.1.
  * The `version` attribute in your YAML definition must be changed from `2.0` to `2.1`.
  * Attributes of `step` must be indented an additional 2 spaces.
    * 2.0 docs/examples/basic.yaml

    ```yaml
      version: 2
      pipeline:
        - step:
          name: basic
          image: alpine:3.8
          commands:
            - hostname
    ```

    * 2.1 docs/examples/basic.yaml

    ```yaml
      version: 2.1
      pipeline:
        - step:
            name: basic
            image: alpine:3.8
            commands:
              - hostname
    ```

  * The `pullpolicy` attribute has been renamed to `pull-policy`.
  * The `workingdir` attribute has been renamed to `working-dir`.
* Added ability to import local files into your pipeline, as full pipelines or as libraries. More info at
docs/examples/import/imports.yaml in the [Getting Started guide](getting-started.md).
* Steps can now be grouped, and grouped steps can be parallelized. More info at docs/examples/steps.yaml in the
[Getting Started guide](getting-started.md).
* Steps and step-groups can be nested. More info at docs/examples/nested_steps.yaml in the
[Getting Started guide](getting-started.md).
* Fixed an issue where older version 2.0 YAML files would cause an `UncaughtException "TypeError: Cannot read
property 'name' of null"` when run with CIX 2.1.
* Fixed an issue where the request npm module was not included in the CIX2 docker image.
* Removed `root-` prefix from first level nested steps.
* Retry `backoff` value is specified in seconds instead of milliseconds.
